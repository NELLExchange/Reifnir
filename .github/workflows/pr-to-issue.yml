name: PR issue management
on:
  pull_request_target:
    types:
      - opened
      - reopened
    branches:
      - main

jobs:
  pr-to-issue:
    runs-on: ubuntu-latest
    if: github.event.pull_request.user.type != 'Bot'
    steps:
      - name: Create Github Issue
        id: create-issue
        uses: dacbd/create-issue-action@v2.0.0
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          title: ${{ github.event.pull_request.title }}
          body: | 
            ${{ github.event.pull_request.body }}
            
            ---
            Issue auto-generated from PR #${{ github.event.pull_request.number }}
          labels: 'auto-issue'
          assignees: ${{ github.event.pull_request.user.login }}
            
      - name: Update PR Description with Github Issue
        uses: nefrob/pr-description@v1.1.2
        with:
          content: |+
            
            ---
            Closes #${{ steps.create-issue.outputs.number }}
          regexFlags: ims
          token: ${{ secrets.GITHUB_TOKEN }}
            